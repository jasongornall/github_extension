// Generated by CoffeeScript 1.8.0
(function() {
  chrome.runtime.onMessage.addListener(function(request, sender, sendResponse) {
    var query;
    console.log('hit');
    switch (request.type) {
      case 'user-info':
        console.log('hit', gh);
        console.log(gh, '123');
        gh.xhrWithAuth('GET', 'https://api.github.com/user', false, function(error, status, response) {
          var json;
          json = JSON.parse(response);
          console.log(error, status, response, 'wakka');
          return sendResponse(json);
        });
        break;
      case 'search-info':
        query = "https://api.github.com/search/issues?q=" + request.query + "+repo:" + request.repo + "&page=" + request.page + "&per_page=" + request.per_page;
        gh.xhrWithAuth('GET', query, false, function(error, status, response) {
          var json;
          console.log(error, status, response);
          json = JSON.parse(response);
          return sendResponse(json);
        });
        break;
      case 'rate-limit':
        gh.xhrWithAuth('GET', "https://api.github.com/rate_limit", false, function(error, status, response) {
          var json;
          json = JSON.parse(response);
          return sendResponse(json);
        });
    }
    return true;
  });


  /* neat idea maybe later
  chrome.tabs.onUpdated.addListener (tabId, changeInfo, tab) ->
    return unless (changeInfo.status == "loading")
  
    if(/^https?:\/\/github\.com.+\/issues/.test(tab.url))
      console.log 'inside'
      chrome.pageAction.setIcon({tabId: tabId, path:"github-green.png"})
    else
      console.log 'outside'
      chrome.pageAction.setIcon({tabId: tabId, path:"github-128.png"})
   */

}).call(this);
